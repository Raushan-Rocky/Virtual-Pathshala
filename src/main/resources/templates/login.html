<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | Virtual Pathshala</title>
  <link rel="stylesheet" th:href="@{/css/login.css}">
  <link rel="icon" type="image/x-icon" th:href="@{/image/favicon.ico}">

  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  /* ===== LOGIN FORM ===== */
.login-container {
  width: 100%;
  max-width: 400px;
  padding: 20px;
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.54);
  box-shadow: 0 6px 15px rgb(220, 155, 15);

  /* ✅ Centering Fix */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.login-card {
  background: rgba(255, 255, 255, 0.7);
  border-radius: 15px;
  padding: 20px 30px;
  box-shadow: 0 8px 25px rgba(46, 4, 255, 0.76);
}
.login-card h2 {
  color: #000;
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 10px;
  text-align: center;
}
.subtitle {
  color: #000;
  margin-bottom: 30px;
  font-size: 14px;
  text-align: center;
}
.login-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ===== INPUTS ===== */
.input-group {
  position: relative;
}
.input-group input {
  width: 100%;
  padding: 15px 45px;
  border: 2px solid #e1e5e9;
  border-radius: 10px;
  font-size: 16px;
  background: #f8f9fa;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  outline: none;
}
.input-group input:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ICONS */
.input-group i {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: #667eea;
  font-size: 20px;
  pointer-events: none;
  z-index: 2;
}
.input-group i.bx-envelope,
.input-group i.bx-lock-alt {
  left: 15px;
}
.input-group i.toggle-eye {
  right: 15px;
  pointer-events: auto;
  cursor: pointer;
}

/* PASSWORD PADDING */
.input-group input[type="password"] {
  padding-left: 45px;
  padding-right: 15px;
}

/* FORM OPTIONS */
.form-options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  color: #666;
}
.checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
}
.checkbox-label input {
  width: auto;
  margin-right: 8px;
  transform: scale(1.2);
}
.forgot-link {
  color: #ff0000;
  text-decoration: none;
  transition: color 0.3s ease;
}
.forgot-link:hover {
  color: #764ba2;
  text-decoration: underline;
  cursor: pointer;
}

/* BUTTON */
.login-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 15px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.login-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

/* SIGNUP LINK */
.signup-link {
  /* margin-top: 20px; */
  color: #000;
  font-size: 14px;
}
.signup-link a {
  color: #e41111;
}
.signup-link a:hover {
  color: #764ba2;
  text-decoration: underline;
}

/* Forgot Link */
.forgot {
  display: block;
  text-align: right;
  font-size: 13px;
  color: #d8fce5;
  margin-bottom: 10px;
}

/* Register New User */
.register-text {
  margin-top: 12px;
  font-size: 14px;
}

.register-text a {
  color: #29ffd7;
  text-decoration: none;
  font-weight: 600;
}

.register-text a:hover {
  text-decoration: underline;
}

  /* Additional CSS for role selection */
    .role-selection {
      margin-bottom: 5px;
      color: #000;
    }

    .role-options {
      display: flex;
      gap: 15px;
      margin-top: 8px;
    }

    .role-option {
      flex: 1;
      padding: 5px;
      border: 2px solid #191818;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }

    .role-option:hover {
      border-color: #6c63ff;
      background-color: #f0f0ff;
    }

    .role-option.selected {
      border-color: #6c63ff;
      background-color: #e6e4ff;
      font-weight: bold;
    }

    .role-option input {
      display: none;
    }

    .role-icon {
      font-size: 24px;
      margin-bottom: 5px;
      display: block;
      color: black;
    }
</style>
</head>
<body>

<!-- Background Video -->
<video autoplay muted loop playsinline id="bg-video">
  <source th:src="@{/video/videoplayback (1).mp4}" type="video/mp4">
</video>

<!-- Header -->
<header>
  <div class="logo">
    <img th:src="@{/image/logo5.png}" alt="Logo">
    <h2>Virtual Pathshala</h2>
  </div>
  <a th:href="@{/signup}" class="signup-header-btn">Sign Up</a>
</header>

<!-- main -->
<div class="login-container">
  <div class="login-card">
    <h2>Welcome Back</h2>
    <p class="subtitle">Sign in to your account</p>
    <form class="login-form" id="loginForm">

      <!-- Role Selection (Visual Only) -->
      <div class="role-selection">
        <label>Select User Type</label>
        <div class="role-options">
          <div class="role-option" data-role="admin">
            <input type="radio" id="role-admin" name="role" value="admin" required>
            <i class='bx bx-user-circle role-icon'></i>
            <span>ADMIN</span>
          </div>
          <div class="role-option" data-role="student">
            <input type="radio" id="role-student" name="role" value="student" required checked>
            <i class='bx bx-book-alt role-icon'></i>
            <span>STUDENT</span>
          </div>
          <div class="role-option" data-role="teacher">
            <input type="radio" id="role-teacher" name="role" value="teacher" required>
            <i class='bx bx-user-circle role-icon'></i>
            <span>TEACHER</span>
          </div>
        </div>
      </div>

      <!-- Email input -->
      <div class="input-group">
        <i class="bx bx-envelope"></i>
        <input type="email" id="email" name="email" placeholder="Email Address" required>
      </div>

      <!-- Password input -->
      <div class="input-group">
        <i class="bx bx-lock-alt"></i>
        <input type="password" id="password" name="password" placeholder="Password" required>
        <i class='bx bx-hide toggle-eye' id="togglePassword"></i>
      </div>

      <div class="form-options">
        <label class="checkbox-label">
          <input type="checkbox" name="remember"> Remember me
        </label>
        <a href="#" class="forgot-link" id="forgotPasswordLink">Forgot Password?</a>
      </div>

      <button type="submit" class="login-btn">Sign In</button>
      <p class="signup-link">Don't have an account? - <a th:href="@{/signup}">Sign up here</a></p>

    </form>
  </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Forgot Password</h2>
    <p>Enter your registered email to reset your password</p>


  </div>
</div>

<!-- Footer -->
<footer>
  Virtual Pathshala © <span id="year"></span>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  document.addEventListener('DOMContentLoaded', () => {
    // ===== Role Selection =====
    const roleOptions = document.querySelectorAll('.role-option');

    roleOptions.forEach(option => {
      option.addEventListener('click', () => {
        roleOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        const radioInput = option.querySelector('input[type="radio"]');
        radioInput.checked = true;
      });
    });

    // Set default selection
    document.querySelector('.role-option[data-role="student"]').classList.add('selected');

    // ===== Password Toggle Visibility =====
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    togglePassword.addEventListener('click', () => {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      togglePassword.classList.toggle('bx-hide');
      togglePassword.classList.toggle('bx-show');
    });

    // ===== Forgot Password Modal =====
    const modal = document.getElementById('forgotModal');
    const forgotLink = document.getElementById('forgotPasswordLink');
    const closeBtn = document.querySelector('.close-btn');

    forgotLink.addEventListener('click', (e) => {
      e.preventDefault();
      modal.style.display = 'flex';
    });

    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // ===== Login Form Submission =====
    const loginForm = document.getElementById('loginForm');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const selectedRole = document.querySelector('input[name="role"]:checked').value;

      if (!email || !password) {
        alert('Please fill in all fields');
        return;
      }

      const loginBtn = loginForm.querySelector('.login-btn');
      const originalText = loginBtn.textContent;
      loginBtn.textContent = 'Signing In...';
      loginBtn.disabled = true;

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password })
        });

        console.log('Response status:', response.status);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Login response:', data);

        if (data.success) {
          // Store user in localStorage (using data.data as in first code)
          if (data.data) {
            localStorage.setItem('user', JSON.stringify(data.data));
            console.log('User data stored successfully');
          }

          // Redirect based on selected role (not backend role)
          let redirectPath = '/student'; // Default

          switch(selectedRole) {
            case 'admin':
              redirectPath = '/admin';
              break;
            case 'teacher':
              redirectPath = '/teacher';
              break;
            case 'student':
            default:
              redirectPath = '/student';
          }

          console.log(`✅ Login successful! Redirecting to ${selectedRole} page...`);
          window.location.href = redirectPath;

        } else {
          alert(data.message || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        alert('Login failed. Please try again. Error: ' + error.message);
      } finally {
        loginBtn.textContent = originalText;
        loginBtn.disabled = false;
      }
    });
  });
</script>

</body>
</html>